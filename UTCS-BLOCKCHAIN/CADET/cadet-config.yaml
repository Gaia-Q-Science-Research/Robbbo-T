---
# UTCS-BLOCKCHAIN/CADET/cadet-config.yaml
# CADET — Circular Assurance by Digital Evolutive Twin
# Configuration for computing monthly KPI cuts from DET evidence.

meta:
  spec: CADET-CONFIG-1.0
  owner: "sustainability@your-org"
  updated: "2025-09-01T00:00:00Z"
  notes: >
    CADET records are monthly KPI cuts derived from signed DET packets.
    Tokenomics normalization/weights belong to TekTok (PoI oracle).
    CADET keeps raw, SI-based KPIs with light aggregation and quality gates.

storage:
  kpi_dir: "UTCS-BLOCKCHAIN/CADET/kpis"
  filename_template: "%Y-%m.yaml" # e.g., 2025-09.yaml
  schema_ref: "UTCS-BLOCKCHAIN/DET/schemas/cadet-record.schema.json"
  write_signature:
    enabled: false # set true if you want to sign CADET files off-chain
    alg: "Ed25519"
    signer_id: "cadet-signer@your-org"

time:
  # All cuts use UTC month boundaries.
  timezone: "UTC"
  period: "monthly"
  close_policy: "end_of_month_23_59_59Z"
  grace_window_days: 2 # allow late-arriving DET packets within 2 days

sources:
  det_glob: "UTCS-BLOCKCHAIN/DET/**/det_packet.json"
  # Map KPI to the DET activities that are allowed to contribute.
  kpi_activity_map:
    reuse_percent: ["design", "save_model", "baseline_freeze"]
    energy_saved_kwh: ["baseline_freeze", "process_update", "wo_close"]
    co2_saved_kg: ["baseline_freeze", "process_update", "wo_close"]
    life_extension_months: ["baseline_freeze", "wo_close", "baseline_freeze"] # sustainment/prolongation
    risk_reduction: ["feasibility_run", "trade_study", "solver_run", "risk_review"]
  # Mandatory packet fields and constraints
  packet_requirements:
    require_refs:
      ce: true
      ci: false
      cc: false
    require_units_in_outputs: true       # outputs.units must be present (SI)
    signature:
      alg: "Ed25519"
      required: true
    hash:
      algo: "sha256"
      hex_length: 64
    timestamp_monotonic: true

guards:
  min_packets_per_cut: 3
  min_independent_sources: 2             # distinct CE IDs or domains contributing
  sigma_outlier: 3                       # discard points beyond ±3σ per KPI
  deduplicate_by_det_id: true
  # If a DET packet contributes to multiple KPIs, it is allowed; to the same KPI twice, it is not.
  forbid_duplicate_kpi_contribution: true

units:
  # Expected SI units for the metrics payload (DET -> outputs.units)
  reuse_percent: "%"         # 0..100 (percentage points)
  energy_saved_kwh: "kWh"
  co2_saved_kg: "kg"
  life_extension_months: "months"
  risk_reduction: "fraction"  # e.g., ΔCVaR in [-1..+1]

aggregation:
  # CADET keeps raw values with light aggregation. PoI oracle will normalize/weight for tokenomics.
  reuse_percent:
    method: "avg"                   # average across window
    decimals: 1
    floor: 0.0
    ceil: 100.0
  energy_saved_kwh:
    method: "sum"
    decimals: 0
    min_value: 0
  co2_saved_kg:
    method: "sum"
    decimals: 0
    min_value: 0
  life_extension_months:
    method: "sum"
    decimals: 0
    min_value: 0
  risk_reduction:
    method: "avg"                   # average ΔCVaR
    decimals: 3

cross_domain:
  enabled: true
  # Allow contributions from other domains to AAA’s cut when referenced through TRACES and canonical aliases.
  require_trace_record: false       # set true if you want mandatory TRACES links for cross-domain claims
  alias_validation: true

traceability:
  traces_glob: "UTCS-BLOCKCHAIN/TRACES/**/*.trace.yaml"
  require_bidirectional: false      # if true, CADET includes only artifacts with verified req↔artifact traces

output_policy:
  include_evidence_list: true       # add the list of contributing DET IDs under `evidence`
  include_methodology_block: true   # add a short methodology summary block in each KPI cut
  rounding: "bankers"               # bankers|floor|ceil for display rounding of decimals

validation:
  # Hard errors that abort the cut generation:
  hard:
    - "missing_units"
    - "invalid_signature"
    - "invalid_hash"
  # Soft warnings logged but not aborting:
  soft:
    - "late_packet_within_grace_window"
    - "non_monotonic_timestamp"
    - "cross_domain_without_trace"

governance:
  dao_contact: "dao@your-org"
  change_control:
    proposal_required: true
    min_reviewers: 2
    cooldown_days: 3
  audit:
    keep_history: true
    history_dir: "UTCS-BLOCKCHAIN/CADET/history"
    include_diff_hash: true

# Example of how a generated cut will look like (for human reference only):
example_cut:
  namespace: "DET:CAD:AAA"
  cut: "2025-09"
  kpis:
    reuse_percent: 41.8
    energy_saved_kwh: 38500
    co2_saved_kg: 1180
    life_extension_months: 12
    risk_reduction: 0.07
  evidence:
    - "DET:CAD:AAA:53-10:design:V5"
    - "DET:CAE:AAA:53-10:solver_run:V3"
  methodology: |
    Aggregation window: month-end UTC. Reuse% averaged across valid packets;
    energy and CO₂ summed; life extension sumada; ΔCVaR promediada.
    Paquetes que fallaron firma/hash/unidades o fuera de ±3σ fueron excluidos.
